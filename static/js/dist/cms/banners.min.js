function Banners(){this.progressGroup=$("#progress-group")}Banners.prototype.loadData=function(){var r=this;xfzajax.get({url:"/cms/banner_list/",success:function(n){if(200===n.code)for(var e=n.data,a=0;a<e.length;a++){var t=e[a];r.createBannerItem(t)}}})},Banners.prototype.listenQiniuUploadFileEvent=function(){var i=this;$("#thumbnail-btn").change(function(){var o=this.files[0];xfzajax.get({url:"/cms/qntoken/",success:function(n){if(200===n.code){var e=n.data.token,a=(new Date).getTime()+"."+o.name.split(".")[1],t={fname:a,params:{},mimeType:["image/png","image/jpeg","image/gif","video/x-ms-wmv"]},r={useCdnDomain:!0,retryCount:6,region:qiniu.region.z2};qiniu.upload(o,a,e,t,r).subscribe({next:i.handleFileUploadProgress,error:i.handleFileUploadError,complete:i.handleFileUploadComplete})}}})})},Banners.prototype.handleFileUploadProgress=function(n){var e=n.total.percent.toFixed(0)+"%";Banners.progressGroup.show();var a=$(".progress-bar");a.css({width:e}),a.text(e)},Banners.prototype.handleFileUploadError=function(n){window.messageBox.showError(n.message),$("#progress-group").hide(),console.log(n.message)},Banners.prototype.handleFileUploadComplete=function(n){console.log(n),$("#progress-group").hide();var e="http://image.amd794.com"+n.key;$("input[name='thumbnail']").val(e)},Banners.prototype.createBannerItem=function(n){var e=this,a=template("banner-item",{banner:n}),t=$(".banner-list-group"),r=null;r=n?(t.append(a),t.find(".banner-item:last")):(t.prepend(a),t.find(".banner-item:first")),e.addImageSelectEvent(r),e.addRemoveBannerEvent(r),e.addSaveBannerEvent(r)},Banners.prototype.listenAddBannerEvent=function(){var n=this;$("#add-banner-btn").click(function(){6<=$(".banner-list-group").children().length?window.messageBox.showInfo("最多只能添加6张轮播图！"):n.createBannerItem()})},Banners.prototype.addImageSelectEvent=function(n){var a=n.find(".thumbnail"),e=n.find(".image-input");a.click(function(){e.click()}),e.change(function(){var n=this.files[0],e=new FormData;e.append("file",n),xfzajax.post({url:"/cms/upload_file/",data:e,processData:!1,contentType:!1,success:function(n){if(200===n.code){var e=n.data.url;a.attr("src",e)}}})})},Banners.prototype.addRemoveBannerEvent=function(e){e.find(".close-btn").click(function(){var n=e.attr("data-banner-id");n?xfzalert.alertConfirm({text:"您确定要删除这个轮播图吗?",confirmCallback:function(){xfzajax.post({url:"/cms/delete_banner/",data:{banner_id:n},success:function(n){200===n.code&&(e.remove(),window.messageBox.showSuccess("轮播图删除才成功！"))}})}}):e.remove()})},Banners.prototype.addSaveBannerEvent=function(o){var n=o.find(".save-btn"),i=o.find(".thumbnail"),s=o.find("input[name='priority']"),d=o.find("input[name='image_url']"),l=o.find("input[name='link_to']"),c=o.find("input[name='silde_title']"),p=o.find('span[class="priority"]'),u=o.attr("data-banner-id"),m="";m=u?"/cms/edit_banner/":"/cms/add_banner/",n.click(function(){var n=i.attr("src"),e=s.val(),a=d.val(),t=l.val(),r=c.val();xfzajax.post({url:m,data:{image_url:n,priority:e,image_url_input:a,link_to:t,silde_title:r,pk:u},success:function(n){200===n.code&&(u?window.messageBox.showSuccess("轮播图修改成功！"):(u=n.data.banner_id,o.attr("data-banner-id",u),window.messageBox.showSuccess("轮播图添加完成！")),p.text("优先级："+e))}})})},Banners.prototype.run=function(){this.listenAddBannerEvent(),this.loadData()},$(function(){(new Banners).run(),Banners.progressGroup=$("#progress-group")});
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImNtcy9iYW5uZXJzLmpzIl0sIm5hbWVzIjpbIkJhbm5lcnMiLCJ0aGlzIiwicHJvZ3Jlc3NHcm91cCIsIiQiLCJwcm90b3R5cGUiLCJsb2FkRGF0YSIsInNlbGYiLCJ4ZnphamF4IiwiZ2V0IiwidXJsIiwic3VjY2VzcyIsInJlc3VsdCIsImJhbm5lcnMiLCJpIiwibGVuZ3RoIiwiYmFubmVyIiwiY3JlYXRlQmFubmVySXRlbSIsImxpc3RlblFpbml1VXBsb2FkRmlsZUV2ZW50IiwiY2hhbmdlIiwiZmlsZSIsImZpbGVzIiwidG9rZW4iLCJrZXkiLCJEYXRlIiwiZ2V0VGltZSIsIm5hbWUiLCJzcGxpdCIsInB1dEV4dHJhIiwiZm5hbWUiLCJwYXJhbXMiLCJtaW1lVHlwZSIsImNvbmZpZyIsInVzZUNkbkRvbWFpbiIsInJldHJ5Q291bnQiLCJyZWdpb24iLCJxaW5pdSIsInoyIiwidXBsb2FkIiwic3Vic2NyaWJlIiwibmV4dCIsImhhbmRsZUZpbGVVcGxvYWRQcm9ncmVzcyIsImVycm9yIiwiaGFuZGxlRmlsZVVwbG9hZEVycm9yIiwiY29tcGxldGUiLCJoYW5kbGVGaWxlVXBsb2FkQ29tcGxldGUiLCJyZXNwb25zZSIsInBlcmNlbnRUZXh0IiwidG90YWwiLCJwZXJjZW50IiwidG9GaXhlZCIsInNob3ciLCJwcm9ncmVzc0JhciIsImNzcyIsIndpZHRoIiwidGV4dCIsIndpbmRvdyIsIm1lc3NhZ2VCb3giLCJzaG93RXJyb3IiLCJtZXNzYWdlIiwiaGlkZSIsImNvbnNvbGUiLCJsb2ciLCJ2YWwiLCJ0cGwiLCJ0ZW1wbGF0ZSIsImJhbm5lckxpc3RHcm91cCIsImJhbm5lckl0ZW0iLCJhcHBlbmQiLCJmaW5kIiwicHJlcGVuZCIsImFkZEltYWdlU2VsZWN0RXZlbnQiLCJhZGRSZW1vdmVCYW5uZXJFdmVudCIsImFkZFNhdmVCYW5uZXJFdmVudCIsImxpc3RlbkFkZEJhbm5lckV2ZW50IiwiY2xpY2siLCJjaGlsZHJlbiIsInNob3dJbmZvIiwiaW1hZ2UiLCJpbWFnZUlucHV0IiwiZm9ybURhdGEiLCJGb3JtRGF0YSIsInBvc3QiLCJkYXRhIiwicHJvY2Vzc0RhdGEiLCJjb250ZW50VHlwZSIsImF0dHIiLCJiYW5uZXJJZCIsInhmemFsZXJ0IiwiYWxlcnRDb25maXJtIiwiY29uZmlybUNhbGxiYWNrIiwiYmFubmVyX2lkIiwicmVtb3ZlIiwic2hvd1N1Y2Nlc3MiLCJzYXZlQnRuIiwiaW1hZ2VUYWciLCJwcmlvcml0eVRhZyIsImltYWdldXJsVGFnIiwibGlua3RvVGFnIiwic2lsZGV0aXRsZVRhZyIsInByaW9yaXR5U3BhbiIsImltYWdlX3VybCIsInByaW9yaXR5IiwiaW1hZ2VfdXJsX2lucHV0IiwibGlua190byIsInNpbGRlX3RpdGxlIiwicGsiLCJydW4iXSwibWFwcGluZ3MiOiJBQUFBLFNBQVNBLFVBQ0xDLEtBQUtDLGNBQWdCQyxFQUFFLG1CQUczQkgsUUFBUUksVUFBVUMsU0FBVyxXQUN6QixJQUFJQyxFQUFPTCxLQUNYTSxRQUFRQyxJQUFJLENBQ1JDLElBQU8sb0JBQ1BDLFFBQVcsU0FBVUMsR0FDakIsR0FBdUIsTUFBbkJBLEVBQWEsS0FHYixJQUZBLElBQUlDLEVBQVVELEVBQWEsS0FFbEJFLEVBQUksRUFBR0EsRUFBSUQsRUFBUUUsT0FBUUQsSUFBSyxDQUNyQyxJQUFJRSxFQUFTSCxFQUFRQyxHQUNyQlAsRUFBS1UsaUJBQWlCRCxRQU8xQ2YsUUFBUUksVUFBVWEsMkJBQTZCLFdBQzNDLElBQUlYLEVBQU9MLEtBQ0tFLEVBQUUsa0JBQ1JlLE9BQU8sV0FDYixJQUFJQyxFQUFPbEIsS0FBS21CLE1BQU0sR0FDdEJiLFFBQVFDLElBQUksQ0FDUkMsSUFBTyxnQkFDUEMsUUFBVyxTQUFVQyxHQUNqQixHQUF1QixNQUFuQkEsRUFBYSxLQUFXLENBQ3hCLElBQUlVLEVBQVFWLEVBQWEsS0FBUyxNQUc5QlcsR0FBTSxJQUFLQyxNQUFRQyxVQUFZLElBQU1MLEVBQUtNLEtBQUtDLE1BQU0sS0FBSyxHQUMxREMsRUFBVyxDQUNYQyxNQUFPTixF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LGFBQzFCMEIsRUFBVzVCLEVBQVdFLEtBQUssY0FDM0IyQixFQUFjN0IsRUFBV0UsS0FBSywwQkFDOUI0QixFQUFjOUIsRUFBV0UsS0FBSywyQkFDOUI2QixFQUFZL0IsRUFBV0UsS0FBSyx5QkFDNUI4QixFQUFnQmhDLEVBQVdFLEtBQUssNkJBQ2hDK0IsRUFBZWpDLEVBQVdFLEtBQUssMEJBQy9Ca0IsRUFBV3BCLEVBQVdtQixLQUFLLGtCQUMzQjVFLEVBQU0sR0FFTkEsRUFEQTZFLEVBQ00sb0JBRUEsbUJBRVZPLEVBQVFuQixNQUFNLFdBQ1YsSUFBSTBCLEVBQVlOLEVBQVNULEtBQUssT0FDMUJnQixFQUFXTixFQUFZakMsTUFDdkJ3QyxFQUFrQk4sRUFBWWxDLE1BQzlCeUMsRUFBVU4sRUFBVW5DLE1BQ3BCMEMsRUFBY04sRUFBY3BDLE1BQ2hDdkQsUUFBUTBFLEtBQUssQ0FDVHhFLElBQU9BLEVBQ1B5RSxLQUFRLENBQ0prQixVQUFhQSxFQUNiQyxTQUFZQSxFQUNaQyxnQkFBbUJBLEVBQ25CQyxRQUFXQSxFQUNYQyxZQUFlQSxFQUNmQyxHQUFNbkIsR0FFVjVFLFFBQVcsU0FBVUMsR0FDTSxNQUFuQkEsRUFBYSxPQUNUMkUsRUFDQS9CLE9BQU9DLFdBQVdvQyxZQUFZLGFBRTlCTixFQUFXM0UsRUFBYSxLQUFhLFVBQ3JDdUQsRUFBV21CLEtBQUssaUJBQWtCQyxHQUNsQy9CLE9BQU9DLFdBQVdvQyxZQUFZLGFBRWxDTyxFQUFhN0MsS0FBSyxPQUFTK0MsVUFPL0NyRyxRQUFRSSxVQUFVc0csSUFBTSxXQUNwQnpHLEtBQUt3RSx1QkFDTHhFLEtBQUtJLFlBR1RGLEVBQUUsWUFDZ0IsSUFBSUgsU0FDVjBHLE1BRVIxRyxRQUFRRSxjQUFnQkMsRUFBRSIsImZpbGUiOiJjbXMvYmFubmVycy5taW4uanMiLCJzb3VyY2VzQ29udGVudCI6WyJmdW5jdGlvbiBCYW5uZXJzKCkge1xyXG4gICAgdGhpcy5wcm9ncmVzc0dyb3VwID0gJChcIiNwcm9ncmVzcy1ncm91cFwiKTtcclxufVxyXG5cclxuQmFubmVycy5wcm90b3R5cGUubG9hZERhdGEgPSBmdW5jdGlvbiAoKSB7XHJcbiAgICB2YXIgc2VsZiA9IHRoaXM7XHJcbiAgICB4ZnphamF4LmdldCh7XHJcbiAgICAgICAgJ3VybCc6ICcvY21zL2Jhbm5lcl9saXN0LycsXHJcbiAgICAgICAgJ3N1Y2Nlc3MnOiBmdW5jdGlvbiAocmVzdWx0KSB7XHJcbiAgICAgICAgICAgIGlmIChyZXN1bHRbJ2NvZGUnXSA9PT0gMjAwKSB7XHJcbiAgICAgICAgICAgICAgICB2YXIgYmFubmVycyA9IHJlc3VsdFsnZGF0YSddO1xyXG4gICAgICAgICAgICAgICAgLy8gY29uc29sZS5sb2coYmFubmVycyk7XHJcbiAgICAgICAgICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IGJhbm5lcnMubGVuZ3RoOyBpKyspIHtcclxuICAgICAgICAgICAgICAgICAgICB2YXIgYmFubmVyID0gYmFubmVyc1tpXTtcclxuICAgICAgICAgICAgICAgICAgICBzZWxmLmNyZWF0ZUJhbm5lckl0ZW0oYmFubmVyKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgIH0pO1xyXG59O1xyXG5cclxuQmFubmVycy5wcm90b3R5cGUubGlzdGVuUWluaXVVcGxvYWRGaWxlRXZlbnQgPSBmdW5jdGlvbiAoKSB7XHJcbiAgICB2YXIgc2VsZiA9IHRoaXM7XHJcbiAgICB2YXIgdXBsb2FkQnRuID0gJCgnI3RodW1ibmFpbC1idG4nKTtcclxuICAgIHVwbG9hZEJ0bi5jaGFuZ2UoZnVuY3Rpb24gKCkge1xyXG4gICAgICAgIHZhciBmaWxlID0gdGhpcy5maWxlc1swXTtcclxuICAgICAgICB4ZnphamF4LmdldCh7XHJcbiAgICAgICAgICAgICd1cmwnOiAnL2Ntcy9xbnRva2VuLycsXHJcbiAgICAgICAgICAgICdzdWNjZXNzJzogZnVuY3Rpb24gKHJlc3VsdCkge1xyXG4gICAgICAgICAgICAgICAgaWYgKHJlc3VsdFsnY29kZSddID09PSAyMDApIHtcclxuICAgICAgICAgICAgICAgICAgICB2YXIgdG9rZW4gPSByZXN1bHRbJ2RhdGEnXVsndG9rZW4nXTtcclxuICAgICAgICAgICAgICAgICAgICAvLyBhLmIuanBnID0gWydhJywnYicsJ2pwZyddXHJcbiAgICAgICAgICAgICAgICAgICAgLy8gMTk4ODg4ODg4ICsgLiArIGpwZyA9IDE5ODg4ODguanBnXHJcbiAgICAgICAgICAgICAgICAgICAgdmFyIGtleSA9IChuZXcgRGF0ZSgpKS5nZXRUaW1lKCkgKyAnLicgKyBmaWxlLm5hbWUuc3BsaXQoJy4nKVsxXTtcclxuICAgICAgICAgICAgICAgICAgICB2YXIgcHV0RXh0cmEgPSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGZuYW1lOiBrZXksXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHBhcmFtczoge30sXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIG1pbWVUeXBlOiBbJ2ltYWdlL3BuZycsICdpbWFnZS9qcGVnJywgJ2ltYWdlL2dpZicsICd2aWRlby94LW1zLXdtdiddXHJcbiAgICAgICAgICAgICAgICAgICAgfTtcclxuICAgICAgICAgICAgICAgICAgICB2YXIgY29uZmlnID0ge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB1c2VDZG5Eb21haW46IHRydWUsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHJ5Q291bnQ6IDYsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHJlZ2lvbjogcWluaXUucmVnaW9uLnoyXHJcbiAgICAgICAgICAgICAgICAgICAgfTtcclxuICAgICAgICAgICAgICAgICAgICB2YXIgb2JzZXJ2YWJsZSA9IHFpbml1LnVwbG9hZChmaWxlLCBrZXksIHRva2VuLCBwdXRFeHRyYSwgY29uZmlnKTtcclxuICAgICAgICAgICAgICAgICAgICBvYnNlcnZhYmxlLnN1YnNjcmliZSh7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICduZXh0Jzogc2VsZi5oYW5kbGVGaWxlVXBsb2FkUHJvZ3Jlc3MsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICdlcnJvcic6IHNlbGYuaGFuZGxlRmlsZVVwbG9hZEVycm9yLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAnY29tcGxldGUnOiBzZWxmLmhhbmRsZUZpbGVVcGxvYWRDb21wbGV0ZVxyXG4gICAgICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfSk7XHJcbiAgICB9KTtcclxufTtcclxuXHJcbkJhbm5lcnMucHJvdG90eXBlLmhhbmRsZUZpbGVVcGxvYWRQcm9ncmVzcyA9IGZ1bmN0aW9uIChyZXNwb25zZSkge1xyXG4gICAgdmFyIHRvdGFsID0gcmVzcG9uc2UudG90YWw7XHJcbiAgICB2YXIgcGVyY2VudCA9IHRvdGFsLnBlcmNlbnQ7XHJcbiAgICB2YXIgcGVyY2VudFRleHQgPSBwZXJjZW50LnRvRml4ZWQoMCkgKyAnJSc7XHJcbiAgICAvLyAyNC4wOTA577yMODkuMDAwLi4uLlxyXG4gICAgdmFyIHByb2dyZXNzR3JvdXAgPSBCYW5uZXJzLnByb2dyZXNzR3JvdXA7XHJcbiAgICBwcm9ncmVzc0dyb3VwLnNob3coKTtcclxuICAgIHZhciBwcm9ncmVzc0JhciA9ICQoXCIucHJvZ3Jlc3MtYmFyXCIpO1xyXG4gICAgcHJvZ3Jlc3NCYXIuY3NzKHtcIndpZHRoXCI6IHBlcmNlbnRUZXh0fSk7XHJcbiAgICBwcm9ncmVzc0Jhci50ZXh0KHBlcmNlbnRUZXh0KTtcclxufTtcclxuXHJcbkJhbm5lcnMucHJvdG90eXBlLmhhbmRsZUZpbGVVcGxvYWRFcnJvciA9IGZ1bmN0aW9uIChlcnJvcikge1xyXG4gICAgd2luZG93Lm1lc3NhZ2VCb3guc2hvd0Vycm9yKGVycm9yLm1lc3NhZ2UpO1xyXG4gICAgdmFyIHByb2dyZXNzR3JvdXAgPSAkKFwiI3Byb2dyZXNzLWdyb3VwXCIpO1xyXG4gICAgcHJvZ3Jlc3NHcm91cC5oaWRlKCk7XHJcbiAgICBjb25zb2xlLmxvZyhlcnJvci5tZXNzYWdlKTtcclxufTtcclxuXHJcbkJhbm5lcnMucHJvdG90eXBlLmhhbmRsZUZpbGVVcGxvYWRDb21wbGV0ZSA9IGZ1bmN0aW9uIChyZXNwb25zZSkge1xyXG4gICAgY29uc29sZS5sb2cocmVzcG9uc2UpO1xyXG4gICAgdmFyIHByb2dyZXNzR3JvdXAgPSAkKFwiI3Byb2dyZXNzLWdyb3VwXCIpO1xyXG4gICAgcHJvZ3Jlc3NHcm91cC5oaWRlKCk7XHJcblxyXG4gICAgdmFyIGRvbWFpbiA9ICdodHRwOi8vaW1hZ2UuYW1kNzk0LmNvbSc7XHJcbiAgICB2YXIgZmlsZW5hbWUgPSByZXNwb25zZS5rZXk7XHJcbiAgICB2YXIgdXJsID0gZG9tYWluICsgZmlsZW5hbWU7XHJcbiAgICB2YXIgdGh1bWJuYWlsSW5wdXQgPSAkKFwiaW5wdXRbbmFtZT0ndGh1bWJuYWlsJ11cIik7XHJcbiAgICB0aHVtYm5haWxJbnB1dC52YWwodXJsKTtcclxufTtcclxuXHJcblxyXG5cclxuQmFubmVycy5wcm90b3R5cGUuY3JlYXRlQmFubmVySXRlbSA9IGZ1bmN0aW9uIChiYW5uZXIpIHtcclxuICAgIHZhciBzZWxmID0gdGhpcztcclxuICAgIHZhciB0cGwgPSB0ZW1wbGF0ZShcImJhbm5lci1pdGVtXCIsIHtcImJhbm5lclwiOiBiYW5uZXJ9KTtcclxuICAgIHZhciBiYW5uZXJMaXN0R3JvdXAgPSAkKFwiLmJhbm5lci1saXN0LWdyb3VwXCIpO1xyXG5cclxuICAgIHZhciBiYW5uZXJJdGVtID0gbnVsbDtcclxuICAgIGlmIChiYW5uZXIpIHtcclxuICAgICAgICBiYW5uZXJMaXN0R3JvdXAuYXBwZW5kKHRwbCk7XHJcbiAgICAgICAgYmFubmVySXRlbSA9IGJhbm5lckxpc3RHcm91cC5maW5kKFwiLmJhbm5lci1pdGVtOmxhc3RcIik7XHJcbiAgICB9IGVsc2Uge1xyXG4gICAgICAgIGJhbm5lckxpc3RHcm91cC5wcmVwZW5kKHRwbCk7XHJcbiAgICAgICAgYmFubmVySXRlbSA9IGJhbm5lckxpc3RHcm91cC5maW5kKFwiLmJhbm5lci1pdGVtOmZpcnN0XCIpO1xyXG4gICAgfVxyXG4gICAgc2VsZi5hZGRJbWFnZVNlbGVjdEV2ZW50KGJhbm5lckl0ZW0pO1xyXG4gICAgc2VsZi5hZGRSZW1vdmVCYW5uZXJFdmVudChiYW5uZXJJdGVtKTtcclxuICAgIHNlbGYuYWRkU2F2ZUJhbm5lckV2ZW50KGJhbm5lckl0ZW0pO1xyXG59O1xyXG5cclxuQmFubmVycy5wcm90b3R5cGUubGlzdGVuQWRkQmFubmVyRXZlbnQgPSBmdW5jdGlvbiAoKSB7XHJcbiAgICB2YXIgc2VsZiA9IHRoaXM7XHJcbiAgICB2YXIgYWRkQnRuID0gJChcIiNhZGQtYmFubmVyLWJ0blwiKTtcclxuICAgIGFkZEJ0bi5jbGljayhmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgdmFyIGJhbm5lckxpc3RHcm91cCA9ICQoJy5iYW5uZXItbGlzdC1ncm91cCcpO1xyXG4gICAgICAgIHZhciBsZW5ndGggPSBiYW5uZXJMaXN0R3JvdXAuY2hpbGRyZW4oKS5sZW5ndGg7XHJcbiAgICAgICAgaWYgKGxlbmd0aCA+PSA2KSB7XHJcbiAgICAgICAgICAgIHdpbmRvdy5tZXNzYWdlQm94LnNob3dJbmZvKCfmnIDlpJrlj6rog73mt7vliqA25byg6L2u5pKt5Zu+77yBJyk7XHJcbiAgICAgICAgICAgIHJldHVybjtcclxuICAgICAgICB9XHJcbiAgICAgICAgc2VsZi5jcmVhdGVCYW5uZXJJdGVtKCk7XHJcbiAgICB9KTtcclxufTtcclxuXHJcbkJhbm5lcnMucHJvdG90eXBlLmFkZEltYWdlU2VsZWN0RXZlbnQgPSBmdW5jdGlvbiAoYmFubmVySXRlbSkge1xyXG4gICAgdmFyIGltYWdlID0gYmFubmVySXRlbS5maW5kKCcudGh1bWJuYWlsJyk7XHJcbiAgICB2YXIgaW1hZ2VJbnB1dCA9IGJhbm5lckl0ZW0uZmluZCgnLmltYWdlLWlucHV0Jyk7XHJcbiAgICAvLyDlm77niYfmmK/kuI3og73lpJ/miZPlvIDmlofku7bpgInmi6nmoYbnmoTvvIzlj6rog73pgJrov4dpbnB1dFt0eXBlPSdmaWxlJ11cclxuICAgIGltYWdlLmNsaWNrKGZ1bmN0aW9uICgpIHtcclxuICAgICAgICBpbWFnZUlucHV0LmNsaWNrKCk7XHJcbiAgICB9KTtcclxuXHJcbiAgICBpbWFnZUlucHV0LmNoYW5nZShmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgdmFyIGZpbGUgPSB0aGlzLmZpbGVzWzBdO1xyXG4gICAgICAgIHZhciBmb3JtRGF0YSA9IG5ldyBGb3JtRGF0YSgpO1xyXG4gICAgICAgIGZvcm1EYXRhLmFwcGVuZChcImZpbGVcIiwgZmlsZSk7XHJcbiAgICAgICAgeGZ6YWpheC5wb3N0KHtcclxuICAgICAgICAgICAgJ3VybCc6ICcvY21zL3VwbG9hZF9maWxlLycsXHJcbiAgICAgICAgICAgICdkYXRhJzogZm9ybURhdGEsXHJcbiAgICAgICAgICAgICdwcm9jZXNzRGF0YSc6IGZhbHNlLFxyXG4gICAgICAgICAgICAnY29udGVudFR5cGUnOiBmYWxzZSxcclxuICAgICAgICAgICAgJ3N1Y2Nlc3MnOiBmdW5jdGlvbiAocmVzdWx0KSB7XHJcbiAgICAgICAgICAgICAgICBpZiAocmVzdWx0Wydjb2RlJ10gPT09IDIwMCkge1xyXG4gICAgICAgICAgICAgICAgICAgIHZhciB1cmwgPSByZXN1bHRbJ2RhdGEnXVsndXJsJ107XHJcbiAgICAgICAgICAgICAgICAgICAgaW1hZ2UuYXR0cignc3JjJywgdXJsKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH0pO1xyXG4gICAgfSk7XHJcbn07XHJcblxyXG5CYW5uZXJzLnByb3RvdHlwZS5hZGRSZW1vdmVCYW5uZXJFdmVudCA9IGZ1bmN0aW9uIChiYW5uZXJJdGVtKSB7XHJcbiAgICB2YXIgY2xvc2VCdG4gPSBiYW5uZXJJdGVtLmZpbmQoJy5jbG9zZS1idG4nKTtcclxuXHJcbiAgICBjbG9zZUJ0bi5jbGljayhmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgdmFyIGJhbm5lcklkID0gYmFubmVySXRlbS5hdHRyKCdkYXRhLWJhbm5lci1pZCcpO1xyXG4gICAgICAgIGlmIChiYW5uZXJJZCkge1xyXG4gICAgICAgICAgICB4ZnphbGVydC5hbGVydENvbmZpcm0oe1xyXG4gICAgICAgICAgICAgICAgJ3RleHQnOiAn5oKo56Gu5a6a6KaB5Yig6Zmk6L+Z5Liq6L2u5pKt5Zu+5ZCXPycsXHJcbiAgICAgICAgICAgICAgICAnY29uZmlybUNhbGxiYWNrJzogZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICAgICAgICAgIHhmemFqYXgucG9zdCh7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICd1cmwnOiAnL2Ntcy9kZWxldGVfYmFubmVyLycsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICdkYXRhJzoge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgJ2Jhbm5lcl9pZCc6IGJhbm5lcklkXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH0sXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICdzdWNjZXNzJzogZnVuY3Rpb24gKHJlc3VsdCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHJlc3VsdFsnY29kZSddID09PSAyMDApIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBiYW5uZXJJdGVtLnJlbW92ZSgpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHdpbmRvdy5tZXNzYWdlQm94LnNob3dTdWNjZXNzKCfova7mkq3lm77liKDpmaTmiY3miJDlip/vvIEnKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICBiYW5uZXJJdGVtLnJlbW92ZSgpO1xyXG4gICAgICAgIH1cclxuICAgIH0pO1xyXG59O1xyXG5cclxuQmFubmVycy5wcm90b3R5cGUuYWRkU2F2ZUJhbm5lckV2ZW50ID0gZnVuY3Rpb24gKGJhbm5lckl0ZW0pIHtcclxuICAgIHZhciBzYXZlQnRuID0gYmFubmVySXRlbS5maW5kKCcuc2F2ZS1idG4nKTtcclxuICAgIHZhciBpbWFnZVRhZyA9IGJhbm5lckl0ZW0uZmluZChcIi50aHVtYm5haWxcIik7XHJcbiAgICB2YXIgcHJpb3JpdHlUYWcgPSBiYW5uZXJJdGVtLmZpbmQoXCJpbnB1dFtuYW1lPSdwcmlvcml0eSddXCIpO1xyXG4gICAgdmFyIGltYWdldXJsVGFnID0gYmFubmVySXRlbS5maW5kKFwiaW5wdXRbbmFtZT0naW1hZ2VfdXJsJ11cIik7XHJcbiAgICB2YXIgbGlua3RvVGFnID0gYmFubmVySXRlbS5maW5kKFwiaW5wdXRbbmFtZT0nbGlua190byddXCIpO1xyXG4gICAgdmFyIHNpbGRldGl0bGVUYWcgPSBiYW5uZXJJdGVtLmZpbmQoXCJpbnB1dFtuYW1lPSdzaWxkZV90aXRsZSddXCIpO1xyXG4gICAgdmFyIHByaW9yaXR5U3BhbiA9IGJhbm5lckl0ZW0uZmluZCgnc3BhbltjbGFzcz1cInByaW9yaXR5XCJdJyk7XHJcbiAgICB2YXIgYmFubmVySWQgPSBiYW5uZXJJdGVtLmF0dHIoXCJkYXRhLWJhbm5lci1pZFwiKTtcclxuICAgIHZhciB1cmwgPSAnJztcclxuICAgIGlmIChiYW5uZXJJZCkge1xyXG4gICAgICAgIHVybCA9ICcvY21zL2VkaXRfYmFubmVyLyc7XHJcbiAgICB9IGVsc2Uge1xyXG4gICAgICAgIHVybCA9ICcvY21zL2FkZF9iYW5uZXIvJztcclxuICAgIH1cclxuICAgIHNhdmVCdG4uY2xpY2soZnVuY3Rpb24gKCkge1xyXG4gICAgICAgIHZhciBpbWFnZV91cmwgPSBpbWFnZVRhZy5hdHRyKCdzcmMnKTtcclxuICAgICAgICB2YXIgcHJpb3JpdHkgPSBwcmlvcml0eVRhZy52YWwoKTtcclxuICAgICAgICB2YXIgaW1hZ2VfdXJsX2lucHV0ID0gaW1hZ2V1cmxUYWcudmFsKCk7XHJcbiAgICAgICAgdmFyIGxpbmtfdG8gPSBsaW5rdG9UYWcudmFsKCk7XHJcbiAgICAgICAgdmFyIHNpbGRlX3RpdGxlID0gc2lsZGV0aXRsZVRhZy52YWwoKTtcclxuICAgICAgICB4ZnphamF4LnBvc3Qoe1xyXG4gICAgICAgICAgICAndXJsJzogdXJsLFxyXG4gICAgICAgICAgICAnZGF0YSc6IHtcclxuICAgICAgICAgICAgICAgICdpbWFnZV91cmwnOiBpbWFnZV91cmwsXHJcbiAgICAgICAgICAgICAgICAncHJpb3JpdHknOiBwcmlvcml0eSxcclxuICAgICAgICAgICAgICAgICdpbWFnZV91cmxfaW5wdXQnOiBpbWFnZV91cmxfaW5wdXQsXHJcbiAgICAgICAgICAgICAgICAnbGlua190byc6IGxpbmtfdG8sXHJcbiAgICAgICAgICAgICAgICAnc2lsZGVfdGl0bGUnOiBzaWxkZV90aXRsZSxcclxuICAgICAgICAgICAgICAgICdwayc6IGJhbm5lcklkXHJcbiAgICAgICAgICAgIH0sXHJcbiAgICAgICAgICAgICdzdWNjZXNzJzogZnVuY3Rpb24gKHJlc3VsdCkge1xyXG4gICAgICAgICAgICAgICAgaWYgKHJlc3VsdFsnY29kZSddID09PSAyMDApIHtcclxuICAgICAgICAgICAgICAgICAgICBpZiAoYmFubmVySWQpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgd2luZG93Lm1lc3NhZ2VCb3guc2hvd1N1Y2Nlc3MoJ+i9ruaSreWbvuS/ruaUueaIkOWKn++8gScpO1xyXG4gICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGJhbm5lcklkID0gcmVzdWx0WydkYXRhJ11bJ2Jhbm5lcl9pZCddO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBiYW5uZXJJdGVtLmF0dHIoJ2RhdGEtYmFubmVyLWlkJywgYmFubmVySWQpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB3aW5kb3cubWVzc2FnZUJveC5zaG93U3VjY2Vzcygn6L2u5pKt5Zu+5re75Yqg5a6M5oiQ77yBJyk7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIHByaW9yaXR5U3Bhbi50ZXh0KFwi5LyY5YWI57qn77yaXCIgKyBwcmlvcml0eSk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9KTtcclxuICAgIH0pO1xyXG59O1xyXG5cclxuQmFubmVycy5wcm90b3R5cGUucnVuID0gZnVuY3Rpb24gKCkge1xyXG4gICAgdGhpcy5saXN0ZW5BZGRCYW5uZXJFdmVudCgpO1xyXG4gICAgdGhpcy5sb2FkRGF0YSgpO1xyXG59O1xyXG5cclxuJChmdW5jdGlvbiAoKSB7XHJcbiAgICB2YXIgYmFubmVycyA9IG5ldyBCYW5uZXJzKCk7XHJcbiAgICBiYW5uZXJzLnJ1bigpO1xyXG5cclxuICAgIEJhbm5lcnMucHJvZ3Jlc3NHcm91cCA9ICQoJyNwcm9ncmVzcy1ncm91cCcpO1xyXG59KTsiXX0=
